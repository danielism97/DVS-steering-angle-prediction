import numpy as np
from keras.preprocessing import image
from PIL import Image
import matplotlib.pyplot as plt
import os
import cv2

# finding the train/dev/test data from the original continuous driving dataset
img_list = []
for i in range(400):
    img_crop = image.load_img("data_orig/" + str(i) + ".jpg", target_size = (30, 40))
    img_crop_array = image.img_to_array(img_crop)

    for j in range(5614):
        img_orig = image.load_img(str(j) + ".jpg", target_size = (30, 40))
        img_orig_array = image.img_to_array(img_orig)
        if(np.array_equal(img_crop_array, img_orig_array)):
            img_list.append(j)

# results
image_list = [5434, 10, 969, 3279, 1252, 3282, 4742, 2334, 1241, 2441, 696, 4836, 3378, 3092, 5236, 4728, 2510, 2062, 2018, 1827, 4830, 1403, 3957, 1503, 3089, 4521, 3628, 3475, 3761, 3560, 4334, 4988, 2353, 1105, 4435, 1858, 2136, 4669, 1805, 2306, 1508, 3964, 3922, 3462, 3666, 914, 4222, 2912, 959, 180, 2507, 3535, 1838, 2395, 4164, 4931, 4374, 1180, 3193, 2531, 614, 1414, 3528, 271, 81, 1670, 4399, 5206, 4788, 4154, 1667, 2231, 1757, 5465, 1891, 4401, 2341, 4244, 4693, 567, 5074, 179, 4800, 3486, 1706, 1357, 2435, 933, 3506, 2657, 4977, 1022, 387, 3538, 5001, 5426, 45, 3902, 564, 2321, 4816, 4622, 4765, 1461, 4495, 4946, 2115, 4877, 2596, 4478, 3090, 1937, 604, 2131, 2138, 1916, 3998, 5233, 1586, 415, 1906, 1705, 4793, 2317, 2473, 3169, 3181, 2241, 4577, 4866, 2935, 235, 5304, 4504, 3432, 1134, 453, 1510, 697, 232, 4762, 13, 4159, 1634, 2491, 299, 5080, 1977, 2249, 3574, 1754, 126, 2442, 2937, 4024, 2668, 1174, 634, 4994, 2729, 1833, 2887, 815, 3045, 1333, 1619, 1145, 217, 2382, 95, 3266, 2113, 3643, 965, 2825, 4505, 4486, 2848, 2664, 5573, 559, 1381, 4701, 4759, 4008, 530, 2653, 1062, 1995, 2499, 1947, 3579, 327, 5605, 4328, 1456, 2613, 2595, 2344, 4645, 1743, 3441, 2767, 3457, 5383, 1466, 828, 1243, 2998, 338, 17, 908, 5433, 3997, 3489, 2494, 3465, 2066, 2426, 1935, 4980, 5568, 4041, 2213, 163, 5030, 1376, 145, 597, 427, 4662, 2586, 3007, 523, 1697, 719, 2056, 2879, 3896, 5370, 1080, 1208, 2028, 1826, 2896, 3545, 5076, 459, 4408, 281, 4210, 3887, 5148, 3525, 3160, 3783, 1160, 5154, 4564, 4560, 5550, 940, 2296, 975, 3612, 3197, 4989, 21, 3439, 4012, 4686, 2371, 5610, 316, 4090, 1846, 5390, 3286, 1936, 713, 4291, 2301, 4323, 3943, 5373, 5403, 2871, 3133, 3154, 3808, 2663, 2802, 473, 429, 1554, 1518, 439, 4522, 4342, 208, 884, 2530, 4982, 5178, 3408, 4744, 5039, 3254, 4443, 4684, 1296, 1538, 970, 1930, 2050, 4588, 2742, 494, 2697, 4473, 114, 4856, 3735, 2616, 1756, 957, 3019, 911, 2727, 756, 992, 843, 1546, 3078, 806, 2548, 1030, 4163, 2875, 4238, 4600, 5339, 5214, 2878, 5190, 3752, 1352, 1304, 2001, 620, 5570, 1957, 2517, 1245, 1446, 3609, 3345, 3476, 4821, 2605, 1859, 2080, 3805, 342, 4011, 3707, 2609, 4990, 3565, 4470, 4315, 4015, 288, 3555, 2101, 2873, 4333, 2724, 1925, 4449, 4003, 1845, 2651, 519, 3835, 1620, 583, 2116, 5513, 722, 5340, 991, 5225, 318, 913, 852, 5166, 920, 1687, 1348]

# creating videos using openCV
frame = cv2.imread('0.jpg')
height, width, layers = frame.shape
interval = 10 # this is the integration interval to be tuned by validation

for i in range(len(image_list)):
    video = cv2.VideoWriter(str(i)+'.mp4', -1, interval, (width, height))

    for image_index in range(image_list[i]-(interval-5), image_list[i]+(interval+5)):
        video.write(cv2.imread(str(image_index)+'.jpg'))

    cv2.destroyAllWindows()
    video.release()
